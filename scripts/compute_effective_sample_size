import waterfall
from waterfall import vault
import numpy as np
import math

w = waterfall.Waterfall.load()
store = vault.connect_db_readonly(w)

log_weights = []
final_structs = store.get_traj_ends()

for s in final_structs:
    log_weights.append(s.work + math.log(s.multiplicity))

samples = len(log_weights)
max_log_weight = max(log_weights)
n = len(store.get_all())

effective_samples = 0.0
for w in log_weights:
    rel = math.exp(w - max_log_weight)
    print(rel)
    effective_samples += rel

print()
print("work units", n)
print("samples:", samples)
print("effective samples:", effective_samples)
print("effective samples per work unit:", effective_samples / n)
